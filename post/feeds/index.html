<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="a social media application" />
    <meta name="author" content="Thong Trong Ho" />
    <title>Contactbook - Posts</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Fira+Sans:wght@200;300;400;500&family=Noto+Sans+JP:wght@400;500;700;900&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/node_modules/bootstrap/dist/css/bootstrap.min.css" />
    <script src="https://kit.fontawesome.com/87903c1d5c.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="/scss/index.css" />
    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.5/dist/umd/popper.min.js"
      integrity="sha384-Xe+8cL9oJa6tN/veChSP7q+mnSPaj5Bcu9mPX5F5xIGE0DVittaqT5lorf0EI7Vk"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.min.js"
      integrity="sha384-ODmDIVzN+pFdexxHEHFBQH3/9/vQ9uori45z4JjnFsRydbmQbmL5t1tQ0culUzyK"
      crossorigin="anonymous"
    ></script>
    <script src="/js/index.mjs" defer type="module"></script>
  </head>
  <body>
    <header>
      <nav class="navigation d-flex justify-content-between px-4">
        <section class="logo-wrap d-flex flex-column justify-content-center">
          <a href="/post/feeds/" class="d-flex">
            <i class="fa-solid fa-address-book text-decoration-none"></i>
            <div class="contactbook ms-2 font-weight-bold">Contactbook</div>
          </a>
        </section>
        <!--HAMBURGER ICON-->
        <section class="navbar navbar-expand-md">
          <a class="navbar-brand" href="#"></a>
          <button
            class="navbar-toggler bg-white"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <div class="navbar-nav justify-content-between">
              <div class="cta-button d-flex">
                <button class="login-btn rounded mx-2" onclick="window.location.href='/login.html'">
                  Login
                </button>
                <button class="sign-up-btn rounded" onclick="window.location.href='/register.html'">
                  Sign up
                </button>
              </div>
            </div>
          </div>
        </section>
      </nav>
    </header>
    <main class="body-wrap px-4 pb-5">
      <section class="newPost pt-4 d-flex justify-content-center">
        <div class="d-flex flex-column">
          <h2>New Post</h2>
          <form action="/postsIndex.html" class="new-post-wrap p-3 rounded">
            <div class="d-flex flex-column">
              <textarea
                name="title"
                id="newPostTitle"
                cols="40"
                rows="1"
                placeholder="Title"
                class="rounded px-2 py-1 mb-2"
              ></textarea>
              <textarea
                name="body"
                id="newPostBody"
                cols="40"
                rows="3"
                placeholder="What are you thinking?"
                class="rounded px-2 py-1 mb-2"
              ></textarea>
              <input
                name="media"
                type="url"
                id="newPostMedia"
                placeholder="Image URL"
                class="rounded px-2 py-1 mb-2"
                cols="40"
                rows="3"
              />
            </div>
            <div class="mt-1">
              <button class="rounded" type="button" id="postButton">Post</button>
            </div>
          </form>
        </div>
      </section>
      <section class="old-post mt-4 d-flex justify-content-center flex-column">
        <div>
          <div class="checkbox-container mb-2">
            <input type="checkbox" id="filterCheckBox" name="filterCheckBox" value="myposts" />
            <label for="filterCheckBox" class="mx-1">Show only my posts</label>
          </div>
          <div class="checkbox-container">
            <input
              type="text"
              id="titleSearchInput"
              name="titleSearchInput"
              value=""
              placeholder="search after title"
            />
          </div>
          <div class="posts-container mt-3 col-12 col-md-6 rounded" id="feeds"></div>
        </div>
      </section>
      <!-- The Modal -->
      <div id="myModal" class="modal py-3">
        <!-- Modal content -->
        <div class="modal-content px-5">
          <span class="close mb-2 d-flex justify-content-end">&times;</span>
          <form id="updatePostForm">
            <div class="form-group mb-3">
              <textarea
                name="title"
                id="newPostTitle"
                cols="40"
                rows="1"
                placeholder="Title"
                class="rounded px-2 py-1 mb-2"
                required
              ></textarea>
            </div>
            <div class="form-group mb-3">
              <textarea
                name="body"
                id="newPostBody"
                cols="40"
                rows="3"
                placeholder="What are you thinking?"
                class="rounded px-2 py-1 mb-2"
                required
              ></textarea>
            </div>
            <div class="form-group mb-3 d-flex flex-column">
              <label for="" class="text-dark">Media </label>
              <input
                name="media"
                type="url"
                id="newPostMedia"
                placeholder="https://example.com"
                class="input-group-text rounded mb-2 d-flex justify-content-start bg-light"
                cols="40"
                rows="3"
                required
              />
            </div>
            <button class="btn btn-success text-light" id="editPostButton">Update Post</button>
          </form>
        </div>
      </div>
    </main>
  </body>
</html>

<script type="module">
  import { renderPosts } from "/js/post/feeds.mjs";
  import { createPost } from "/js/post/createPost.mjs";
  import { getPost } from "/js/post/getPost.mjs";
  import { setUpdateFormListener } from "/js/updatePostHandler.mjs";

  const filterCheckBox = document.getElementById("filterCheckBox");

  const titleSearchInput = document.getElementById("titleSearchInput");

  // render all post first time user load the page
  await renderPosts(false, "");

  filterCheckBox.onchange = async () => {
    await renderPosts(filterCheckBox.checked, titleSearchInput.value);
  };

  titleSearchInput.onkeydown = async (e) => {
    // key code 13 is enter key
    if (e.keyCode == 13) {
      await renderPosts(filterCheckBox.checked, titleSearchInput.value);
    }
  };

  const postButton = document.getElementById("postButton");
  const newPostTitle = document.getElementById("newPostTitle");
  const newPostBody = document.getElementById("newPostBody");
  const newPostMedia = document.getElementById("newPostMedia");

  postButton.onclick = async function () {
    const postData = {
      title: newPostTitle.value,
      body: newPostBody.value,
      media: newPostMedia.value,
    };

    if (postData.title && postData.body && postData.media) {
      await createPost(postData);
      await renderPosts(filterCheckBox.checked, titleSearchInput.value);
    } else {
      alert("Please fill all the fields");
    }
  };

  const editPostButton = document.getElementById("editPostButton");
  const editPostTitle = document.getElementById("newPostTitle");
  const editPostBody = document.getElementById("newPostBody");
  const editPostMedia = document.getElementById("newPostMedia");

  if (editPostButton) {
    editPostButton.onclick = async function () {
      setUpdateFormListener();
    };
  }
</script>
