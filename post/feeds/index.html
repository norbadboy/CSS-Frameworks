<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="a social media application" />
    <meta name="author" content="Thong Trong Ho" />
    <title>Contactbook - Posts</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Fira+Sans:wght@200;300;400;500&family=Noto+Sans+JP:wght@400;500;700;900&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/node_modules/bootstrap/dist/css/bootstrap.min.css" />
    <script src="https://kit.fontawesome.com/87903c1d5c.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="/scss/index.css" />
    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.5/dist/umd/popper.min.js"
      integrity="sha384-Xe+8cL9oJa6tN/veChSP7q+mnSPaj5Bcu9mPX5F5xIGE0DVittaqT5lorf0EI7Vk"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.min.js"
      integrity="sha384-ODmDIVzN+pFdexxHEHFBQH3/9/vQ9uori45z4JjnFsRydbmQbmL5t1tQ0culUzyK"
      crossorigin="anonymous"
    ></script>
    <script src="/js/index.mjs" defer type="module"></script>
  </head>
  <body>
    <header>
      <nav class="navigation d-flex justify-content-between px-4">
        <section class="logo-wrap d-flex flex-column justify-content-center">
          <a href="#" class="d-flex">
            <i class="fa-solid fa-address-book text-decoration-none"></i>
            <div class="contactbook ms-2 font-weight-bold">Contactbook</div>
          </a>
        </section>
        <!--HAMBURGER ICON-->
        <section class="navbar navbar-expand-md">
          <a class="navbar-brand" href="#"></a>
          <button
            class="navbar-toggler bg-white"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <div class="navbar-nav justify-content-between">
              <form class="form-wrap d-flex">
                <input class="form-control me-1" type="search" placeholder="Search" />
                <button class="search-btn rounded" type="submit">
                  <i class="fa fa-search" id="search-bar-icon"></i>
                </button>
              </form>
              <div class="cta-button d-flex">
                <button class="login-btn rounded mx-2" onclick="window.location.href='/login.html'">
                  Login
                </button>
                <button class="sign-up-btn rounded" onclick="window.location.href='/register.html'">
                  Sign up
                </button>
              </div>
            </div>
          </div>
        </section>
      </nav>
    </header>
    <main class="body-wrap px-4 pb-5">
      <section class="newPost pt-4 d-flex justify-content-center">
        <div class="d-flex flex-column">
          <h2>New Post</h2>
          <form action="/postsIndex.html" class="new-post-wrap p-3 rounded">
            <textarea
              name="new-post--text"
              id="newPostTitle"
              cols="40"
              rows="3"
              placeholder="What are you thinking?"
              class="rounded"
            ></textarea>
            <br />
            <div class="mt-1">
              <button class="rounded" type="button" id="postButton">Post</button>
              <input class="rounded ms-2" type="button" value="Upload img" />
            </div>
          </form>
        </div>
      </section>
      <section class="old-post mt-4 d-flex justify-content-center flex-column">
        <div>
          <div class="checkbox-container">
            <input type="checkbox" id="filterCheckBox" name="filterCheckBox" value="myposts" />
            <label for="filterCheckBox">Show only my posts</label>
          </div>

          <div class="checkbox-container">
            <input
              type="text"
              id="titleSearchInput"
              name="titleSearchInput"
              value=""
              placeholder="search after title"
            />
          </div>
          <div class="posts-container mt-3 col-12 col-md-6 rounded" id="feeds"></div>
        </div>
      </section>
    </main>
  </body>
</html>

<script type="module">
  import { renderPosts } from "/js/post/feeds.mjs";
  import { createPost } from "/js/post/createPost.mjs";

  const filterCheckBox = document.getElementById("filterCheckBox");

  const titleSearchInput = document.getElementById("titleSearchInput");

  // render all post first time user load the page
  await renderPosts(false, "");

  filterCheckBox.onchange = async () => {
    await renderPosts(filterCheckBox.checked, titleSearchInput.value);
  };

  titleSearchInput.onkeydown = async (e) => {
    // key code 13 is enter key
    if (e.keyCode == 13) {
      await renderPosts(filterCheckBox.checked, titleSearchInput.value);
    }
  };

  const postButton = document.getElementById("postButton");
  const newPostTitle = document.getElementById("newPostTitle");
  postButton.onclick = async function () {
    const postData = {
      title: newPostTitle.value,
      body: "lorem ipsum",
      media:
        "https://i.picsum.photos/id/827/200/200.jpg?hmac=7S4fBvNQXv9S9XZnxThhj6tOFH_ktFgHQ8xkIW9lNcQ",
    };

    await createPost(postData);
    await renderPosts(filterCheckBox.checked, titleSearchInput.value);
  };
</script>
